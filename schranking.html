<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Ranking - BMSS Rubik's Cube Club</title>
    <!-- Include cubing icons CSS -->
    <link rel="stylesheet" href="https://cdn.cubing.net/v0/css/@cubing/icons/css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            color: #333;
            padding-bottom: 80px;
        }
        nav {
            background-color: #69a769;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 1rem;
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        nav a:hover {
            background-color: rgba(255,255,255,0.2);
        }
        .active {
            background-color: white;
            color: #69a769;
        }
        .menu-toggle {
            display: none;
            cursor: pointer;
            color: white;
            font-size: 1.5rem;
            margin-right: 1rem;
        }
        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }
        nav li {
            margin-left: 1rem;
        }
        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 80vh;
            padding: 2rem;
            padding-bottom: 5rem;
            text-align: center;
        }
        h1, h2 {
            color: #69a769;
        }
        h1 { font-size: 2.5rem; margin-bottom: 1rem; }
        h2 { font-size: 1.8rem; margin: 1rem 0; }
        p { max-width: 600px; line-height: 1.6; color: #666; }
        .buttons { margin: 1rem 0; }
        .button { 
            background-color: #69a769; 
            color: white; 
            padding: 0.8rem 1.5rem; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 0 0.5rem;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        .button:hover { background-color: #7CFC00; }
        .button.active { 
            background-color: white; 
            color: #69a769; 
            border: 2px solid #69a769;
        }
        .event-icons { display: flex; flex-wrap: wrap; justify-content: center; margin: 2rem 0; }
        .event-icon { 
            margin: 1rem; 
            cursor: pointer; 
            font-size: 2rem; 
            padding: 0.5rem;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .event-icon:hover { background-color: #e9f5e9; }
        .event-icon.active { background-color: #69a769; color: white; }
        table { width: 80%; max-width: 800px; border-collapse: collapse; margin: 2rem auto; background-color: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        table th, table td { border: 1px solid #69a769; padding: 0.8rem; text-align: left; }
        table th { background-color: #69a769; color: white; }
        table tr:nth-child(even) { background-color: #f2f2f2; }
        table a { color: #69a769; text-decoration: none; }
        table a:hover { text-decoration: underline; color: #7CFC00; }
        .hidden { display: none; }
        .loading { 
            text-align: center; 
            padding: 2rem; 
            color: #666; 
            font-style: italic;
        }
        .error { 
            text-align: center; 
            padding: 2rem; 
            color: #d32f2f; 
            background-color: #ffebee;
            border-radius: 5px;
            margin: 1rem 0;
        }
        footer { background-color: #69a769; color: white; text-align: center; padding: 1rem; position: fixed; bottom: 0; width: 100%; }
        
        @media (max-width: 768px) {
            nav {
                justify-content: space-between;
            }
            nav ul {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background-color: #69a769;
                z-index: 1000;
            }
            nav ul.show {
                display: flex;
            }
            nav li {
                margin: 0;
                text-align: center;
                padding: 1rem;
            }
            .menu-toggle {
                display: block;
            }
            h1 {
                font-size: 2rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            p {
                font-size: 1rem;
                padding: 0 1rem;
            }
            main {
                padding: 1.5rem 1rem;
            }
            table {
                width: 95%;
                font-size: 0.9rem;
            }
            .button {
                padding: 0.7rem 1.2rem;
                font-size: 0.9rem;
                margin: 0.2rem;
            }
            footer {
                font-size: 0.9rem;
                padding: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-bottom: 100px;
            }
            nav a {
                font-size: 0.9rem;
                padding: 0.6rem 0.8rem;
            }
            h1 {
                font-size: 1.5rem;
            }
            h2 {
                font-size: 1.3rem;
            }
            p {
                font-size: 0.9rem;
            }
            main {
                padding: 1rem 0.5rem;
                min-height: calc(100vh - 200px);
            }
            table {
                width: 100%;
                font-size: 0.8rem;
            }
            .event-icon {
                font-size: 1.5rem;
                margin: 0.5rem;
            }
            footer {
                font-size: 0.8rem;
                padding: 0.6rem;
                line-height: 1.4;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
        <ul id="nav-menu">
            <li><a href="index.html" onclick="closeMenu()">Home</a></li>
            <li><a href="aboutus.html" onclick="closeMenu()">About Us</a></li>
            <li><a href="schranking.html" class="active" onclick="closeMenu()">School Ranking</a></li>
            <li><a href="events.html" onclick="closeMenu()">Events</a></li>
            <li><a href="members.html" onclick="closeMenu()">Members</a></li>
            <li><a href="library.html" onclick="closeMenu()">Library</a></li>
        </ul>
    </nav>
    
    <main>
        <h1>School Ranking</h1>
        
        <!-- Buttons for Unofficial and Official -->
        <div class="buttons">
            <button class="button active" id="unofficial-btn" onclick="setSection('unofficial')">Unofficial Ranking</button>
            <button class="button" id="official-btn" onclick="setSection('official')">Official Ranking</button>
        </div>
        
        <!-- Description -->
        <p>Discover the impressive skills of our BMSS Rubik's Cube Club members through our comprehensive rankings! Whether it's unofficial practice times or official competition results, explore by selecting an icon below.</p>
        
        <!-- Event Icons using cubing icons -->
        <h2>Select an Event</h2>
        <div class="event-icons">
            <span class="cubing-icon event-333 event-icon active" onclick="showTable('3x3x3')"></span>  <!-- 3x3x3 icon -->
            <span class="cubing-icon event-222 event-icon" onclick="showTable('2x2x2')"></span>  <!-- 2x2x2 icon -->
            <span class="cubing-icon event-444 event-icon" onclick="showTable('4x4x4')"></span>  <!-- 4x4x4 icon -->
            <span class="cubing-icon event-555 event-icon" onclick="showTable('5x5x5')"></span>  <!-- 5x5x5 icon -->
            <span class="cubing-icon event-666 event-icon" onclick="showTable('6x6x6')"></span>  <!-- 6x6x6 icon -->
            <span class="cubing-icon event-777 event-icon" onclick="showTable('7x7x7')"></span>  <!-- 7x7x7 icon -->
            <span class="cubing-icon event-333bf event-icon" onclick="showTable('3x3x3BLD')"></span>  <!-- 3x3x3 BLD icon -->
            <span class="cubing-icon event-333fm event-icon" onclick="showTable('FMC')"></span>  <!-- FMC icon -->
            <span class="cubing-icon event-333oh event-icon" onclick="showTable('3x3x3OH')"></span>  <!-- 3x3x3 OH icon -->
            <span class="cubing-icon event-clock event-icon" onclick="showTable('Clock')"></span>  <!-- Clock icon -->
            <span class="cubing-icon event-minx event-icon" onclick="showTable('Megaminx')"></span>  <!-- Megaminx icon -->
            <span class="cubing-icon event-pyram event-icon" onclick="showTable('Pyraminx')"></span>  <!-- Pyraminx icon -->
            <span class="cubing-icon event-skewb event-icon" onclick="showTable('Skewb')"></span>  <!-- Skewb icon -->
            <span class="cubing-icon event-sq1 event-icon" onclick="showTable('Square-1')"></span>  <!-- Square-1 icon -->
            <span class="cubing-icon event-444bf event-icon" onclick="showTable('4x4x4BLD')"></span>  <!-- 4x4x4 BLD icon -->
            <span class="cubing-icon event-555bf event-icon" onclick="showTable('5x5x5BLD')"></span>  <!-- 5x5x5 BLD icon -->
            <span class="cubing-icon event-333mbf event-icon" onclick="showTable('3x3x3MBLD')"></span>  <!-- 3x3x3 MBLD icon -->
        </div>
        
        <!-- Dynamic Table Area -->
        <div id="table-area">
            <h3 id="section-title"></h3>
            <table id="ranking-table">
                <thead>
                    <tr><th>Rank</th><th>Name</th><th>Single Time</th><th>Average Time</th></tr>
                </thead>
                <tbody id="ranking-tbody"></tbody>
            </table>
        </div>
    </main>
    
    <footer>
        &copy; 2025 BMSS Rubik's Cube Club. Hosted on GitHub Pages.
    </footer>
    
    <script>
        function toggleMenu() {
            document.getElementById('nav-menu').classList.toggle('show');
        }
        
        function closeMenu() {
            document.getElementById('nav-menu').classList.remove('show');
        }
        
        document.addEventListener('click', function(event) {
            const navMenu = document.getElementById('nav-menu');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (!navMenu.contains(event.target) && !menuToggle.contains(event.target)) {
                closeMenu();
            }
        });
        
        let currentSection = 'unofficial';
        let currentEvent = '3x3x3';
        
        const eventMapping = {
            '3x3x3': '333',
            '2x2x2': '222',
            '4x4x4': '444',
            '5x5x5': '555',
            '6x6x6': '666',
            '7x7x7': '777',
            '3x3x3BLD': '333bf',
            'FMC': '333fm',
            '3x3x3OH': '333oh',
            'Clock': 'clock',
            'Megaminx': 'minx',
            'Pyraminx': 'pyram',
            'Skewb': 'skewb',
            'Square-1': 'sq1',
            '4x4x4BLD': '444bf',
            '5x5x5BLD': '555bf',
            '3x3x3MBLD': '333mbf'
        };
        
        function setSection(section) {
            currentSection = section;
            
            document.getElementById('unofficial-btn').classList.toggle('active', section === 'unofficial');
            document.getElementById('official-btn').classList.toggle('active', section === 'official');
            
            showTable(currentEvent);
        }
        
        function showTable(event) {
            currentEvent = event;
            
            document.querySelectorAll('.event-icon').forEach(icon => {
                icon.classList.remove('active');
            });
            document.querySelector(`.event-${eventMapping[event]}`).classList.add('active');
            
            document.getElementById('section-title').textContent = event + ' Ranking';
            loadDataForEvent(currentSection, event);
        }
        
        function formatTime(centiseconds, eventId) {
            if (centiseconds === -1) return 'DNF';
            if (centiseconds === -2) return 'DNS';
            if (centiseconds === 0) return '';
            
            if (eventId === '333fm') {
                if (centiseconds >= 0) {
                    return (centiseconds / 10).toFixed(1);
                }
                return centiseconds;
            }
            
            if (eventId === '333mbf') {
                const missed = centiseconds % 100;
                const timeInSeconds = Math.floor(centiseconds / 100);
                const solved = 99 - missed;
                const attempted = solved + missed;
                const hours = Math.floor(timeInSeconds / 3600);
                const minutes = Math.floor((timeInSeconds % 3600) / 60);
                const seconds = timeInSeconds % 60;
                return `${solved}/${attempted} ${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            const minutes = Math.floor(centiseconds / 6000);
            const seconds = Math.floor((centiseconds % 6000) / 100);
            const hundredths = centiseconds % 100;
            
            if (minutes > 0) {
                return `${minutes}:${seconds.toString().padStart(2, '0')}.${hundredths.toString().padStart(2, '0')}`;
            } else {
                return `${seconds}.${hundredths.toString().padStart(2, '0')}`;
            }
        }
        
        async function loadDataForEvent(type, event) {
            const tbody = document.getElementById('ranking-tbody');
            
            if (type === 'unofficial') {
                tbody.innerHTML = '<tr><td colspan="4" class="loading">Loading unofficial data...</td></tr>';
                
                try {
                    const response = await fetch('rankings-data.json');
                    const data = await response.json();
                    tbody.innerHTML = '';
                    
                    const eventData = data[type].find(e => e.event === event);
                    if (eventData && eventData.data) {
                        eventData.data.forEach(item => {
                            const row = tbody.insertRow();
                            row.insertCell().textContent = item.rank;
                            
                            if (item.wcaId) {
                                const nameCell = row.insertCell();
                                nameCell.innerHTML = `<a href="https://www.worldcubeassociation.org/persons/${item.wcaId}" target="_blank" rel="noopener noreferrer">${item.name}</a>`;
                            } else {
                                row.insertCell().textContent = item.name;
                            }
                            
                            row.insertCell().textContent = item.single;
                            row.insertCell().textContent = item.average;
                        });
                    } else {
                        tbody.innerHTML = '<tr><td colspan="4">No unofficial data available</td></tr>';
                    }
                } catch (error) {
                    console.error('Error loading unofficial data:', error);
                    tbody.innerHTML = '<tr><td colspan="4" class="error">Error loading unofficial data</td></tr>';
                }
            } else {
                tbody.innerHTML = '<tr><td colspan="4" class="loading">Loading official data from WCA...</td></tr>';
                
                try {
                    const wcaEventId = eventMapping[event];
                    if (!wcaEventId) {
                        tbody.innerHTML = '<tr><td colspan="4">Event not supported for official rankings</td></tr>';
                        return;
                    }
                    
                    const bmssMembers = [
                        '2022TANT01', '2025LINJ04', '2025PARK69', '2025RAGH05'
                    ];
                    
                    let allResults = [];
                    
                    for (const wcaId of bmssMembers) {
                        const response = await fetch(`https://www.worldcubeassociation.org/api/v0/persons/${wcaId}`);
                        const personData = await response.json();
                        
                        const eventResult = personData.personal_records?.[wcaEventId];
                        if (eventResult) {
                            allResults.push({
                                name: personData.person.name,
                                wcaId: wcaId,
                                single: eventResult.single?.best || 0,
                                average: eventResult.average?.best || 0,
                                singleResult: eventResult.single,
                                averageResult: eventResult.average
                            });
                        }
                    }
                    
                    allResults.sort((a, b) => {
                        if (a.single === 0) return 1;
                        if (b.single === 0) return -1;
                        return a.single - b.single;
                    });
                    
                    tbody.innerHTML = '';
                    
                    if (allResults.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4">No official results found for BMSS members</td></tr>';
                        return;
                    }
                    
                    allResults.forEach((result, index) => {
                        const row = tbody.insertRow();
                        row.insertCell().textContent = index + 1;
                        
                        const nameCell = row.insertCell();
                        nameCell.innerHTML = `<a href="https://www.worldcubeassociation.org/persons/${result.wcaId}" target="_blank" rel="noopener noreferrer">${result.name}</a>`;
                        
                        const singleTime = formatTime(result.single, wcaEventId);
                        const averageTime = formatTime(result.average, wcaEventId);
                        
                        row.insertCell().textContent = singleTime;
                        row.insertCell().textContent = averageTime;
                    });
                    
                } catch (error) {
                    console.error('Error loading official data:', error);
                    tbody.innerHTML = '<tr><td colspan="4" class="error">Error loading official data from WCA</td></tr>';
                }
            }
        }
        
        window.onload = () => {
            setSection('unofficial');
            showTable('3x3x3');
        };
    </script>
</body>
</html>

